<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pantheon Rising</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;500;600;700&family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
<style>
:root{
  --gold:#c9a84c;--gold-b:#f0c040;--gold-d:#7a5c1e;
  --bg:#07060a;--bgc:#100d16;--stone:#18131f;
  --cream:#e8dfc0;--faith:#3ecf6a;--wrath:#b44ce8;--favor:#4a9eff;
  --text:#c0b494;--dim:#5a4f38;--sgold:0 0 40px rgba(240,192,64,.2);
}
*{margin:0;padding:0;box-sizing:border-box;}html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--cream);font-family:'EB Garamond',serif;min-height:100vh;overflow-x:hidden;}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:9999;opacity:.45;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='.04'/%3E%3C/svg%3E");}

/* ─ SCREENS ─ */
.screen{display:none;min-height:100vh;padding:0 16px;}
.screen.active{display:block;animation:fadeUp .55s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:none;}}
@keyframes pulse{0%,100%{opacity:.7;transform:scale(1);}50%{opacity:1;transform:scale(1.05);}}
@keyframes wave{0%,100%{transform:translateX(-18px) scaleY(1);}50%{transform:translateX(18px) scaleY(1.12);}}
@keyframes flick{0%,100%{opacity:1;}50%{opacity:.6;}75%{opacity:.88;}}
@keyframes fire{0%,100%{transform:scaleY(1) rotate(-2deg);}50%{transform:scaleY(1.3) rotate(2deg);}}
@keyframes shim{0%,100%{opacity:.45;}50%{opacity:1;}}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes bob{0%,100%{transform:translateY(0);}50%{transform:translateY(-8px);}}
@keyframes wrathPulse{0%,100%{box-shadow:0 0 0 0 rgba(180,76,232,0);}50%{box-shadow:0 0 0 6px rgba(180,76,232,.15);}}

#cv{position:fixed;inset:0;pointer-events:none;z-index:0;}

/* ─ HEADER ─ */
.hd{text-align:center;padding:40px 20px 24px;position:relative;z-index:1;max-width:960px;margin:0 auto;}
.hd::after{content:'';display:block;height:1px;margin-top:18px;background:linear-gradient(90deg,transparent,var(--gold-d),var(--gold),var(--gold-d),transparent);}
.ey{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.5em;color:var(--gold-d);text-transform:uppercase;margin-bottom:8px;}
.gt{font-family:'Cinzel Decorative',serif;font-size:clamp(2rem,6.5vw,3.6rem);color:var(--gold-b);text-shadow:0 0 60px rgba(240,192,64,.4),0 2px 8px rgba(0,0,0,.95);letter-spacing:.05em;line-height:1.1;}
.ab{display:inline-block;font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.35em;color:var(--bg);background:var(--gold-d);padding:3px 14px;border-radius:2px;text-transform:uppercase;margin-top:10px;}

/* ─ METRICS ─ */
.mbar{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;max-width:960px;margin:14px auto 10px;padding:0 16px;position:relative;z-index:1;}
.met{background:var(--bgc);border:1px solid rgba(201,168,76,.1);border-radius:4px;padding:11px 13px;position:relative;overflow:hidden;}
.met::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.02),transparent);}
.ml{font-family:'Cinzel',serif;font-size:.52rem;letter-spacing:.28em;text-transform:uppercase;margin-bottom:6px;}
.ml.f{color:var(--faith);} .ml.w{color:var(--wrath);} .ml.v{color:var(--favor);}
.mtr{height:4px;background:rgba(255,255,255,.05);border-radius:2px;overflow:hidden;margin-bottom:5px;}
.mfi{height:100%;border-radius:2px;transition:width .65s cubic-bezier(.4,0,.2,1);}
.mfi.f{background:linear-gradient(90deg,#166a2e,var(--faith));box-shadow:0 0 8px rgba(62,207,106,.3);}
.mfi.w{background:linear-gradient(90deg,#5a0a8a,var(--wrath));box-shadow:0 0 8px rgba(180,76,232,.4);}
.mfi.v{background:linear-gradient(90deg,#0f2f60,var(--favor));box-shadow:0 0 8px rgba(74,158,255,.3);}
.mv{font-family:'Cinzel',serif;font-size:.95rem;font-weight:600;}
.mv.f{color:var(--faith);} .mv.w{color:var(--wrath);} .mv.v{color:var(--favor);}
/* Wrath pulsing when high */
.met.danger{animation:wrathPulse 2s ease-in-out infinite;}

/* ─ WIN THRESHOLD TRACKER ─ */
.win-tracker{max-width:960px;margin:0 auto 14px;padding:0 16px;position:relative;z-index:1;}
.wt-inner{background:var(--bgc);border:1px solid rgba(201,168,76,.1);border-radius:4px;padding:10px 16px;display:flex;gap:20px;align-items:center;flex-wrap:wrap;}
.wt-label{font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.3em;text-transform:uppercase;color:var(--gold-d);margin-right:4px;}
.wt-item{display:flex;align-items:center;gap:8px;font-family:'Cinzel',serif;font-size:.7rem;}
.wt-badge{padding:2px 10px;border-radius:2px;font-size:.6rem;letter-spacing:.15em;}
.wt-badge.need{background:rgba(62,207,106,.12);color:var(--faith);border:1px solid rgba(62,207,106,.3);}
.wt-badge.avoid{background:rgba(180,76,232,.12);color:var(--wrath);border:1px solid rgba(180,76,232,.3);}
.wt-badge.ok{background:rgba(74,158,255,.1);color:var(--favor);border:1px solid rgba(74,158,255,.2);}
.wt-sep{width:1px;height:20px;background:rgba(201,168,76,.1);}

/* ─ POWER ZONE ─ */
.pzone{text-align:center;margin:0 auto 12px;max-width:960px;padding:0 16px;position:relative;z-index:1;}
.pb{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.22em;text-transform:uppercase;padding:7px 20px;background:linear-gradient(135deg,rgba(201,168,76,.1),rgba(201,168,76,.04));border:1px solid var(--gold-d);color:var(--gold);border-radius:3px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden;}
.pb::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(240,192,64,.07),transparent);transform:translateX(-100%);transition:transform .4s;}
.pb:hover::before{transform:translateX(100%);}
.pb:hover{border-color:var(--gold-b);box-shadow:var(--sgold);}
.pb.used,.pb:disabled{opacity:.22;cursor:not-allowed;filter:grayscale(1);pointer-events:none;}

/* ─ GAME AREA ─ */
.ga{max-width:960px;margin:0 auto;padding:0 16px 60px;position:relative;z-index:1;}

/* ─ SCENES ─ */
.sv{width:100%;height:195px;border-radius:6px 6px 0 0;overflow:hidden;position:relative;}
.se{position:absolute;}

/* ─ SCENARIO CARD ─ */
.sc{background:var(--bgc);border:1px solid rgba(201,168,76,.18);border-top:none;border-radius:0 0 6px 6px;padding:24px 28px;margin-bottom:16px;position:relative;}
.sc::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:55%;height:1px;background:linear-gradient(90deg,transparent,rgba(201,168,76,.18),transparent);}
.sn{font-family:'Cinzel',serif;font-size:1.25rem;color:var(--gold);margin-bottom:8px;letter-spacing:.04em;}
.sd{font-size:1.08rem;line-height:1.82;color:var(--text);font-style:italic;}

/* ─ CHOICES ─ */
.cl{font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.4em;color:var(--dim);text-transform:uppercase;margin-bottom:10px;}
.ch{
  display:block;width:100%;background:var(--stone);border:1px solid rgba(201,168,76,.12);
  border-radius:4px;padding:14px 18px 14px 22px;margin-bottom:8px;cursor:pointer;
  text-align:left;transition:all .2s;position:relative;overflow:hidden;
}
.ch::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--gold-d);transition:all .22s;}
.ch:hover{border-color:rgba(201,168,76,.4);background:rgba(201,168,76,.05);transform:translateX(4px);}
.ch:hover::before{background:var(--gold-b);box-shadow:0 0 10px rgba(240,192,64,.5);}
.ch:disabled{opacity:.3;cursor:not-allowed;transform:none;}
.ch.sel-best::before{background:var(--gold-b);box-shadow:0 0 14px rgba(240,192,64,.7);}
.ch.sel-good::before{background:var(--faith);box-shadow:0 0 10px rgba(62,207,106,.5);}
.ch.sel-neutral::before{background:#aaa;}
.ch.sel-bad::before{background:#e08820;}
.ch.sel-fail::before{background:var(--wrath);box-shadow:0 0 10px rgba(180,76,232,.6);}
.ch-glyph{font-family:'Cinzel',serif;font-size:.7rem;color:var(--gold-d);margin-bottom:4px;letter-spacing:.1em;}
.ch-text{font-size:1rem;color:var(--cream);line-height:1.5;}

/* ─ OUTCOME ─ */
.ob{border-radius:4px;padding:20px 24px;margin:16px 0;border-left:3px solid;display:none;animation:fadeUp .4s ease;}
.ob.best{border-color:var(--gold-b);background:rgba(240,192,64,.06);}
.ob.good{border-color:var(--faith);background:rgba(62,207,106,.06);}
.ob.neutral{border-color:#aaa;background:rgba(255,255,255,.04);}
.ob.bad{border-color:#e08820;background:rgba(224,136,32,.05);}
.ob.fail{border-color:var(--wrath);background:rgba(180,76,232,.07);}
.ot{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.28em;text-transform:uppercase;margin-bottom:9px;}
.ob.best .ot{color:var(--gold-b);} .ob.good .ot{color:var(--faith);}
.ob.neutral .ot{color:#aaa;} .ob.bad .ot{color:#e08820;} .ob.fail .ot{color:var(--wrath);}
.otx{font-size:1.06rem;line-height:1.82;color:var(--text);}
.ldr{display:flex;align-items:center;gap:10px;color:var(--dim);font-style:italic;font-size:.9rem;}
.ldr-sp{width:14px;height:14px;border:2px solid var(--gold-d);border-top-color:var(--gold);border-radius:50%;animation:spin .8s linear infinite;}
.pills{display:flex;gap:8px;flex-wrap:wrap;margin-top:11px;}
.pill{font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.1em;padding:3px 11px;border-radius:20px;border:1px solid;}
.pf+{color:var(--faith);border-color:var(--faith);}
.pf-{color:#e06850;border-color:#e06850;}
.pw+{color:var(--wrath);border-color:var(--wrath);}
.pv+{color:var(--favor);border-color:var(--favor);}
.pv-{color:#e08840;border-color:#e08840;}

/* ─ NEXT BTN ─ */
.nb{display:none;margin:16px auto 0;font-family:'Cinzel',serif;font-size:.72rem;letter-spacing:.3em;text-transform:uppercase;padding:11px 34px;background:transparent;border:1px solid var(--gold-d);color:var(--gold);border-radius:3px;cursor:pointer;transition:all .22s;}
.nb:hover{border-color:var(--gold-b);color:var(--gold-b);box-shadow:var(--sgold);}

/* ─ INTRO ─ */
#si{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:60px 20px;min-height:100vh;position:relative;}
.ib{font-size:1.12rem;line-height:1.92;color:var(--text);max-width:540px;margin:0 auto 32px;font-style:italic;}
.div{color:var(--gold-d);font-size:1rem;letter-spacing:.8em;margin:20px 0;}

/* ─ GOD SELECT ─ */
#sgs{padding:0 16px 60px;}
.sel-intro{text-align:center;max-width:580px;margin:0 auto 30px;color:var(--text);font-size:1rem;line-height:1.8;font-style:italic;}
.gg{display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:14px;max-width:960px;margin:0 auto 28px;}
.gc{background:var(--bgc);border:2px solid rgba(201,168,76,.1);border-radius:6px;padding:24px 18px;cursor:pointer;text-align:center;transition:all .22s;position:relative;overflow:hidden;}
.gc::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.02),transparent);pointer-events:none;}
.gc:hover{border-color:rgba(201,168,76,.45);transform:translateY(-4px);box-shadow:var(--sgold);}
.gc.sel{border-color:var(--gold-b);box-shadow:0 0 28px rgba(240,192,64,.28);}
.gi{font-size:3rem;margin-bottom:12px;display:block;color:var(--gold);text-shadow:0 0 20px rgba(201,168,76,.4);font-family:'Cinzel',serif;}
.gn{font-family:'Cinzel',serif;font-size:.95rem;color:var(--gold);margin-bottom:6px;}
.gd{font-size:.82rem;color:var(--dim);margin-bottom:10px;font-style:italic;}
.gb{font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.18em;color:var(--favor);text-transform:uppercase;}
.gp{font-size:.76rem;color:var(--dim);margin-top:9px;line-height:1.5;padding:7px;border:1px solid rgba(201,168,76,.09);border-radius:3px;background:rgba(0,0,0,.2);}

.ni{max-width:400px;margin:0 auto 24px;text-align:center;}
.nl{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.3em;color:var(--gold-d);text-transform:uppercase;display:block;margin-bottom:10px;}
.ninp{width:100%;background:var(--stone);border:1px solid rgba(201,168,76,.22);border-radius:4px;padding:11px 16px;color:var(--cream);font-family:'Cinzel',serif;font-size:.9rem;letter-spacing:.1em;text-align:center;outline:none;transition:border-color .2s;}
.ninp:focus{border-color:var(--gold);}
.ninp::placeholder{color:var(--dim);}

/* ─ PRIMARY/SECONDARY BTNS ─ */
.btn{font-family:'Cinzel',serif;font-size:.78rem;letter-spacing:.32em;text-transform:uppercase;padding:14px 48px;background:linear-gradient(135deg,var(--gold-d),var(--gold));color:var(--bg);border:none;border-radius:3px;cursor:pointer;font-weight:700;transition:all .22s;box-shadow:0 4px 18px rgba(201,168,76,.18);}
.btn:hover{box-shadow:0 4px 36px rgba(201,168,76,.42);transform:translateY(-2px);}
.btn:disabled{opacity:.3;cursor:not-allowed;transform:none;}
.btn2{font-family:'Cinzel',serif;font-size:.68rem;letter-spacing:.28em;text-transform:uppercase;padding:10px 26px;background:transparent;border:1px solid var(--gold-d);color:var(--gold);border-radius:3px;cursor:pointer;transition:all .2s;}
.btn2:hover{border-color:var(--gold-b);box-shadow:var(--sgold);}
.nav{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:22px;}

/* ─ EVENT OVERLAY ─ */
#evo{display:none;position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:200;justify-content:center;align-items:center;}
.evb{max-width:460px;width:90%;background:var(--bgc);border:1px solid var(--gold-d);border-radius:6px;padding:36px 32px;text-align:center;position:relative;}
.evb::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.ev-ic{font-size:2.5rem;margin-bottom:14px;display:block;color:var(--gold);text-shadow:0 0 18px rgba(201,168,76,.5);font-family:'Cinzel',serif;}
.ev-ti{font-family:'Cinzel',serif;font-size:1.05rem;color:var(--gold);margin-bottom:10px;}
.ev-de{font-size:.98rem;color:var(--text);line-height:1.72;font-style:italic;margin-bottom:16px;}
.ev-ef{font-family:'Cinzel',serif;font-size:.72rem;letter-spacing:.18em;margin-bottom:20px;}

/* ─ FAIL OVERLAY ─ */
#fo{display:none;position:fixed;inset:0;background:rgba(0,0,0,.97);z-index:300;justify-content:center;align-items:center;text-align:center;padding:20px;}
.fi{max-width:480px;}
.fic{font-size:4.5rem;margin-bottom:18px;display:block;}
.ft{font-family:'Cinzel Decorative',serif;font-size:1.9rem;color:var(--wrath);margin-bottom:12px;text-shadow:0 0 40px rgba(180,76,232,.5);}
.fm{font-size:1.02rem;color:var(--text);line-height:1.75;margin-bottom:26px;font-style:italic;}

/* ─ ENDING ─ */
#se{text-align:center;padding:40px 20px 60px;}
.eic{font-size:3.5rem;margin-bottom:18px;display:block;animation:bob 3s ease-in-out infinite;color:var(--gold);font-family:'Cinzel',serif;text-shadow:0 0 30px rgba(201,168,76,.5);}
.etl{font-family:'Cinzel Decorative',serif;font-size:clamp(1.7rem,5vw,2.5rem);margin-bottom:12px;}
.etl.win{color:var(--gold-b);text-shadow:0 0 36px rgba(240,192,64,.4);}
.etl.partial{color:#e0a040;}
.etl.fail{color:var(--wrath);}
.esu{font-size:1.08rem;line-height:1.88;color:var(--text);max-width:560px;margin:0 auto 26px;font-style:italic;}
.ests{display:flex;gap:14px;justify-content:center;flex-wrap:wrap;margin-bottom:28px;}
.est{font-family:'Cinzel',serif;font-size:.88rem;padding:11px 18px;border:1px solid rgba(201,168,76,.16);border-radius:4px;background:var(--bgc);}

/* ─ LEADERBOARD ─ */
#slb{padding:0 16px 60px;}
.lbt{max-width:740px;margin:0 auto;}
.lbr{display:grid;grid-template-columns:36px 1fr 70px 70px 70px 80px;gap:8px;align-items:center;padding:11px 14px;border-bottom:1px solid rgba(201,168,76,.07);background:var(--bgc);margin-bottom:3px;border-radius:3px;font-size:.88rem;}
.lbr.lbh{font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.18em;color:var(--dim);text-transform:uppercase;background:transparent;border-bottom:1px solid rgba(201,168,76,.18);}
.lbrk{font-family:'Cinzel',serif;color:var(--gold-d);font-weight:600;}
.lbrk.top{color:var(--gold-b);}
.lbnm{font-family:'Cinzel',serif;font-size:.82rem;}
.lbbg{font-size:.72rem;color:var(--dim);font-style:italic;}
.lb-ld{text-align:center;padding:36px;color:var(--dim);font-style:italic;}

@media(max-width:580px){
  .mbar{grid-template-columns:1fr;}
  .gg{grid-template-columns:1fr 1fr;}
  .wt-inner{gap:10px;}
  .lbr{grid-template-columns:28px 1fr 55px 55px;}
  .lbr>*:nth-child(5),.lbr>*:nth-child(6){display:none;}
}
</style>
</head>
<body>
<canvas id="cv"></canvas>

<!-- ══ INTRO ══ -->
<div id="si" class="screen active">
  <div style="position:relative;z-index:1;width:100%;">
    <div class="ey">⚡ A Greek God Strategy Game ⚡</div>
    <h1 class="gt">Pantheon Rising</h1>
    <div class="div">✦ ✦ ✦</div>
    <p class="ib">You have just ascended to divinity — a new god born from mortal prayers and ancient prophecy.<br>
    Rival gods watch with hungry eyes. The fates hold their breath.<br><br>
    <strong style="color:var(--gold);font-family:'Cinzel',serif;">Not every righteous path leads to glory. Choose wisely.</strong></p>
    <button class="btn" onclick="goto('sgs')">Begin Your Ascension</button>
    <div class="nav"><button class="btn2" onclick="gotoLB()">⚖ Hall of Legends</button></div>
  </div>
</div>

<!-- ══ GOD SELECT ══ -->
<div id="sgs" class="screen">
  <div class="hd">
    <div class="ey">Step I — Choose Your Domain</div>
    <h1 class="gt">Pantheon Rising</h1>
  </div>
  <p class="sel-intro">Your domain shapes your divine power, starting gifts, and the kind of stories mortals will tell of you for eternity.</p>
  <div class="gg" id="gg"></div>
  <div class="ni">
    <label class="nl">Your Divine Name</label>
    <input class="ninp" id="pni" type="text" placeholder="e.g. Aethon, Lyris, Solvara…" maxlength="22">
  </div>
  <div style="text-align:center">
    <button class="btn" id="bb" onclick="startGame()" disabled>Ascend to Olympus →</button>
  </div>
</div>

<!-- ══ GAME ══ -->
<div id="sg" class="screen">
  <div class="hd">
    <div class="ey" id="plbl">The Ascended</div>
    <h1 class="gt">Pantheon Rising</h1>
    <div class="ab" id="abg">Act I — The Awakening</div>
  </div>
  <!-- Metrics -->
  <div class="mbar">
    <div class="met" id="met-f">
      <div class="ml f">⚡ Faith</div>
      <div class="mtr"><div class="mfi f" id="bf" style="width:50%"></div></div>
      <div class="mv f" id="vf">50</div>
    </div>
    <div class="met" id="met-w">
      <div class="ml w">◉ Wrath</div>
      <div class="mtr"><div class="mfi w" id="bw" style="width:0%"></div></div>
      <div class="mv w" id="vw">0</div>
    </div>
    <div class="met">
      <div class="ml v">◇ Favor</div>
      <div class="mtr"><div class="mfi v" id="bv" style="width:20%"></div></div>
      <div class="mv v" id="vv">20</div>
    </div>
  </div>
  <!-- Win Thresholds -->
  <div class="win-tracker">
    <div class="wt-inner">
      <span class="wt-label">Victory Requires:</span>
      <span class="wt-item"><span class="wt-badge need">Faith ≥ 65</span></span>
      <div class="wt-sep"></div>
      <span class="wt-item"><span class="wt-badge avoid">Wrath ≤ 30</span></span>
      <div class="wt-sep"></div>
      <span class="wt-item" style="color:var(--dim);font-size:.62rem;">Partial win if Faith ≥ 45 &amp; Wrath ≤ 55</span>
    </div>
  </div>
  <!-- Power -->
  <div class="pzone">
    <button class="pb" id="pbt" onclick="usePower()">✦ Divine Power: <span id="pbn">—</span> <span id="pbcd" style="color:var(--dim);"></span></button>
  </div>
  <!-- Scene + Card -->
  <div class="ga">
    <div class="sv" id="sv"></div>
    <div class="sc" id="scard">
      <div class="sn" id="sn"></div>
      <div class="sd" id="sdesc"></div>
    </div>
    <div class="cl">— You stand at the crossroads of fate — choose your divine will —</div>
    <div id="chcon"></div>
    <div class="ob" id="ob">
      <div class="ot" id="ott"></div>
      <div class="otx" id="otx"></div>
      <div class="pills" id="pls"></div>
    </div>
    <div style="text-align:center"><button class="nb" id="nbt" onclick="nextScen()">Continue →</button></div>
  </div>
</div>

<!-- ══ ENDING ══ -->
<div id="se" class="screen">
  <div class="hd"><h1 class="gt">Pantheon Rising</h1></div>
  <div style="position:relative;z-index:1;">
    <span class="eic" id="eic">✦</span>
    <div class="etl" id="etl"></div>
    <p class="esu" id="esu"></p>
    <div class="ests" id="ests"></div>
    <div class="nav">
      <button class="btn" onclick="restart()">Begin a New Age</button>
      <button class="btn2" onclick="gotoLB()">⚖ Hall of Legends</button>
    </div>
  </div>
</div>

<!-- ══ LEADERBOARD ══ -->
<div id="slb" class="screen">
  <div class="hd">
    <div class="ey">Eternal Records</div>
    <h1 class="gt">Hall of Legends</h1>
  </div>
  <div style="position:relative;z-index:1;">
    <div class="lbt">
      <div class="lbr lbh"><span>#</span><span>Deity</span><span style="text-align:center">Faith</span><span style="text-align:center">Wrath</span><span style="text-align:center">Favor</span><span style="text-align:center">Result</span></div>
      <div id="lbb"></div>
    </div>
    <div class="nav" style="margin-top:28px;">
      <button class="btn" onclick="goto('sgs')">Play Again</button>
      <button class="btn2" onclick="goto('si')">← Main Menu</button>
    </div>
  </div>
</div>

<!-- ══ EVENT OVERLAY ══ -->
<div id="evo">
  <div class="evb">
    <span class="ev-ic" id="evic" style="font-family:'Cinzel',serif;color:var(--gold);">✦</span>
    <div class="ev-ti" id="evti"></div>
    <div class="ev-de" id="evde"></div>
    <div class="ev-ef" id="evef"></div>
    <button class="btn2" onclick="closeEv()">Accept the Omen</button>
  </div>
</div>

<!-- ══ FAIL OVERLAY ══ -->
<div id="fo">
  <div class="fi">
    <span class="fic" style="font-size:3rem;font-family:'Cinzel',serif;color:var(--wrath);text-shadow:0 0 30px rgba(180,76,232,.55);">◉</span>
    <div class="ft">The Gods Turn Away</div>
    <div class="fm" id="fm"></div>
    <button class="btn" onclick="restart()">Rise Again</button>
  </div>
</div>

<script>
// ══════════════════════════════════════════════
// PARTICLES
// ══════════════════════════════════════════════
const cv = document.getElementById('cv');
const ctx = cv.getContext('2d');
let pts = [];
function rsz(){cv.width=innerWidth;cv.height=innerHeight;}
rsz(); window.addEventListener('resize',rsz);
for(let i=0;i<55;i++) pts.push({x:Math.random()*innerWidth,y:Math.random()*innerHeight,r:Math.random()*1.4+.2,s:Math.random()*.28+.04,op:Math.random()*.45+.08,dx:(Math.random()-.5)*.18});
function animPts(){
  ctx.clearRect(0,0,cv.width,cv.height);
  pts.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=`rgba(201,168,76,${p.op})`;ctx.fill();p.y-=p.s;p.x+=p.dx;if(p.y<-4){p.y=cv.height+4;p.x=Math.random()*cv.width;}});
  requestAnimationFrame(animPts);
}
animPts();

// ══════════════════════════════════════════════
// AUDIO
// ══════════════════════════════════════════════
let ac=null;
function getAC(){if(!ac)ac=new(window.AudioContext||window.webkitAudioContext)();return ac;}
function tone(f,t,d,g=.1,dl=0){try{const a=getAC(),o=a.createOscillator(),gn=a.createGain();o.connect(gn);gn.connect(a.destination);o.type=t;o.frequency.value=f;const T=a.currentTime+dl;gn.gain.setValueAtTime(0,T);gn.gain.linearRampToValueAtTime(g,T+.05);gn.gain.exponentialRampToValueAtTime(.001,T+d);o.start(T);o.stop(T+d);}catch(e){}}
function chord(fs,t,d,g){fs.forEach((f,i)=>tone(f,t,d,g,i*.05));}
function sfxSel(){tone(420,'sine',.25,.08);}
function sfxBest(){chord([523,659,784,1047],'sine',1.1,.07);setTimeout(()=>tone(1047,'sine',.35,.05),700);}
function sfxGood(){chord([440,554,659],'sine',.9,.07);}
function sfxNeutral(){chord([350,440],'sine',.5,.06);}
function sfxBad(){chord([330,415],'sine',.6,.06);setTimeout(()=>tone(280,'sine',.4,.07),400);}
function sfxFail(){chord([220,277,330],'sine',1.4,.07);setTimeout(()=>tone(165,'sine',.9,.09),700);}
function sfxPower(){[600,700,850,1050].forEach((f,i)=>setTimeout(()=>tone(f,'sine',.28,.11),i*55));}
function sfxEvent(){chord([350,440,523],'sine',.7,.06);}

// ══════════════════════════════════════════════
// DOMAINS
// ══════════════════════════════════════════════
const DOMAINS = [
  {id:'wisdom',icon:'◈',name:'God of Wisdom',domain:'Counsel & Foresight',bonus:'Start: Favor +12',power:'Oracle\'s Eye',pdesc:'Reveals which choice carries the least Wrath before you commit.',start:{faith:0,wrath:0,favor:12}},
  {id:'valor', icon:'◆',name:'God of Valor', domain:'Courage & War',    bonus:'Start: Faith +12',power:'Battle Grace',pdesc:'Doubles Faith gain from the next scenario you play.',start:{faith:12,wrath:0,favor:0}},
  {id:'earth', icon:'◬',name:'God of the Earth',domain:'Growth & Endurance',bonus:'Wrath grows 30% slower',power:'Still Waters',pdesc:'Purges 25 Wrath from your divine spirit immediately.',start:{faith:0,wrath:0,favor:0}},
  {id:'sea',   icon:'◇',name:'God of the Sea', domain:'Tides & Change',   bonus:'Start: Faith +6, Favor +6',power:'Shifting Tide',pdesc:'Swap your current Wrath and Favor values.',start:{faith:6,wrath:0,favor:6}},
];

// ══════════════════════════════════════════════
// SCENARIOS — 7 scenarios, 5 choices each.
// Choices are deliberately ambiguous. No hints.
// Types: best / good / neutral / bad / fail
// ══════════════════════════════════════════════
const SCENS = [
 {
  act:'Act I — The Awakening',actN:1,
  scHTML:`
  <div class="se" style="inset:0;background:linear-gradient(180deg,#c47a28 0%,#8a4810 25%,#5a2e08 55%,#1e0e04 100%);"></div>
  <div class="se" style="inset:0;background:radial-gradient(ellipse at 50% 0%,rgba(255,200,80,.18) 0%,transparent 55%);"></div>
  <div class="se" style="top:6%;left:50%;transform:translateX(-50%);width:90px;height:90px;background:radial-gradient(circle,rgba(255,220,100,.95),rgba(230,140,30,.6) 45%,transparent 70%);border-radius:50%;filter:blur(8px);opacity:.7;"></div>
  <div class="se" style="bottom:0;left:0;right:0;height:42%;background:linear-gradient(180deg,#3a1a06,#1a0a02);"></div>
  <div class="se" style="bottom:40%;left:0;right:0;height:4px;background:linear-gradient(90deg,transparent,rgba(180,90,20,.6),transparent);"></div>
  <svg class="se" style="bottom:0;left:0;right:0;width:100%;height:45%;" viewBox="0 0 800 200" preserveAspectRatio="none">
    <polygon points="0,200 0,120 40,115 40,100 60,95 60,115 120,110 120,90 150,85 150,110 220,105 220,95 260,90 260,105 340,100 340,85 380,80 380,100 460,95 460,105 520,100 520,80 560,75 560,100 640,95 640,110 700,105 700,90 740,88 740,110 800,108 800,200" fill="#150804" opacity=".95"/>
  </svg>
  <svg class="se" style="bottom:40%;left:8%;width:60px;height:90px;" viewBox="0 0 60 90"><line x1="30" y1="0" x2="20" y2="90" stroke="#2a1206" stroke-width="3"/><line x1="30" y1="10" x2="50" y2="90" stroke="#2a1206" stroke-width="2"/><line x1="28" y1="25" x2="10" y2="90" stroke="#2a1206" stroke-width="2"/></svg>
  <svg class="se" style="bottom:40%;right:12%;width:50px;height:75px;" viewBox="0 0 50 75"><line x1="25" y1="0" x2="15" y2="75" stroke="#2a1206" stroke-width="3"/><line x1="25" y1="12" x2="42" y2="75" stroke="#2a1206" stroke-width="2"/></svg>
  <div class="se" style="bottom:40%;left:0;right:0;height:1px;background:repeating-linear-gradient(90deg,#3a1a08 0,#3a1a08 30px,transparent 30px,transparent 45px);opacity:.6;"></div>
  <div class="se" style="bottom:38%;left:15%;right:15%;height:2%;background:repeating-linear-gradient(90deg,rgba(80,35,8,.8) 0,rgba(80,35,8,.8) 18px,transparent 18px,transparent 28px);"></div>`,
  name:'Village Famine',
  desc:'A village of three hundred withers under drought. The elders have sacrificed their last grain to your altar. Children with cracked lips call your name into a merciless sky. The land itself seems to hold its breath, waiting.',
  choices:[
   {g:'Ι',  t:'Flood the fields with torrential divine rain',     type:'bad',     tag:'Rash Intervention ⚠',  delta:{faith:5, wrath:12,favor:0}, out:'The rains come — violent, unrelenting. The crops you meant to save are flattened by hail and mud. The village survives, barely, but whispers spread among the gods that you act without restraint.'},
   {g:'ΙΙ', t:'Appear in the elder\'s dream bearing a map of the underground river', type:'best', tag:'Divine Counsel ⭐', delta:{faith:16,wrath:0, favor:2}, out:'By morning the elders are digging. Within a week, water flows where none has before. The miracle is spoken of for generations, and even Athena acknowledges your subtle wisdom.'},
   {g:'ΙΙΙ',t:'Command that the neighboring valley send its grain as tribute', type:'fail',   tag:'Divine Arrogance ✕', delta:{faith:-8,wrath:18,favor:-6},out:'You overreach. The neighboring valley refuses, and your demand awakens deep resentment among both mortals and gods. Ares laughs from Olympus. Wrath has entered your crown.'},
   {g:'ΙV', t:'Bless what little grain remains so it multiplies sevenfold', type:'good',   tag:'Measured Mercy ✓',   delta:{faith:11,wrath:0, favor:0}, out:'The granaries swell beyond expectation. The village survives. Faith rises in your name — though some older gods wonder if you rob mortals of the lessons that hardship teaches.'},
   {g:'V',  t:'Declare the famine a sacred trial — suffering refines the soul', type:'neutral',tag:'Cold Theology ◆',    delta:{faith:-4,wrath:6, favor:0}, out:'The village suffers on. A few mortals find a grim strength in the ordeal. But most simply mourn. The gods neither condemn nor praise you — they merely watch, unmoved.'},
  ]
 },
 {
  act:'Act I — The Awakening',actN:1,
  scHTML:`
  <div class="se" style="inset:0;background:linear-gradient(180deg,#040810 0%,#060f1c 35%,#08182a 65%,#0a2035 100%);"></div>
  <div class="se" style="inset:0;background:repeating-linear-gradient(175deg,transparent,transparent 10px,rgba(180,215,255,.018) 10px,rgba(180,215,255,.018) 11px);"></div>
  <div class="se" style="bottom:0;left:0;right:0;height:50%;overflow:hidden;">
    <div style="position:absolute;bottom:0;left:-5%;width:110%;height:88%;background:linear-gradient(180deg,rgba(8,50,90,.0),rgba(10,55,100,.92));border-radius:40% 40% 0 0;animation:wave 3.5s ease-in-out infinite;"></div>
    <div style="position:absolute;bottom:0;left:-8%;width:116%;height:72%;background:rgba(6,38,72,.88);border-radius:35% 35% 0 0;animation:wave 2.8s ease-in-out infinite reverse;"></div>
    <div style="position:absolute;bottom:0;left:-3%;width:106%;height:50%;background:rgba(4,28,58,.92);border-radius:22% 22% 0 0;animation:wave 2.2s ease-in-out infinite;"></div>
  </div>
  <div class="se" style="bottom:48%;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(60,140,200,.35),transparent);"></div>
  <svg class="se" style="bottom:48%;left:0;width:100%;height:48%;" viewBox="0 0 800 200" preserveAspectRatio="none">
    <rect x="60" y="50" width="90" height="150" fill="#050c18" opacity=".92"/>
    <rect x="66" y="28" width="78" height="30" fill="#050c18" opacity=".92"/>
    <polygon points="75,28 105,5 135,28" fill="#050c18" opacity=".92"/>
    <rect x="100" y="65" width="12" height="40" fill="#08121e" opacity=".7"/>
    <rect x="270" y="70" width="70" height="130" fill="#050c18" opacity=".88"/>
    <rect x="278" y="48" width="54" height="28" fill="#050c18" opacity=".88"/>
    <rect x="490" y="55" width="100" height="145" fill="#050c18" opacity=".9"/>
    <rect x="498" y="32" width="84" height="30" fill="#050c18" opacity=".9"/>
    <polygon points="498,32 540,8 582,32" fill="#050c18" opacity=".9"/>
    <rect x="660" y="78" width="65" height="122" fill="#050c18" opacity=".85"/>
    <rect x="666" y="55" width="53" height="28" fill="#050c18" opacity=".85"/>
  </svg>`,
  name:'The Flooding River',
  desc:'The Axios swells with ungodly fury. A village of five hundred clings to rooftops as brown water swallows their world. The river god, Potamos, watches with indifferent ancient eyes. He is older than you. He does not fear you.',
  choices:[
   {g:'Ι',  t:'Wrestle the river itself — assert dominance over Potamos', type:'fail',   tag:'Reckless Defiance ✕', delta:{faith:3, wrath:20,favor:-8},out:'Potamos does not yield easily. The struggle shatters a valley and floods three more villages. The gods convene in alarm. Your Wrath is ascendant and your judgment is questioned.'},
   {g:'ΙΙ', t:'Quietly redirect a tributary upstream to relieve the pressure',  type:'best',  tag:'Hidden Hand ⭐',       delta:{faith:15,wrath:0, favor:3}, out:'The flood crests and begins to recede within hours. The villagers attribute it to luck, to Potamos\' mercy. Only you know otherwise — and that restraint earns nods of approval from Athena and Hermes.'},
   {g:'ΙΙΙ',t:'Part the river open with a gesture visible across ten leagues',  type:'bad',   tag:'Showmanship ⚠',       delta:{faith:7, wrath:14,favor:0}, out:'The gesture is spectacular. Bards will sing of it. But the exposure — the raw, unashamed display of power — stirs jealousy among the gods and the beginning of Wrath in your spirit.'},
   {g:'ΙV', t:'Grant the village carpenter the knowledge to build a proper levee', type:'good',  tag:'Quiet Teaching ✓',    delta:{faith:12,wrath:0, favor:0}, out:'The carpenter works through the night. By dawn, the levee holds. The people celebrate their own ingenuity — and somewhere in that pride, faith in you deepens without dependency.'},
   {g:'V',  t:'Pray alongside the mortals at the river\'s edge for Potamos\' mercy', type:'neutral',tag:'Humble Supplication ◆',delta:{faith:4, wrath:0, favor:4}, out:'The river recedes — perhaps of its own accord, perhaps not. Potamos seems almost amused. The villagers are moved that a god would kneel with them. Favor with the older gods rises slightly.'},
  ]
 },
 {
  act:'Act II — Rivalry Emerges',actN:2,
  scHTML:`
  <div class="se" style="inset:0;background:radial-gradient(ellipse at 50% -10%,#1a0828 0%,#08040f 55%,#030208 100%);"></div>
  <div class="se" style="inset:0;background-image:radial-gradient(circle,rgba(255,255,255,.7) 1px,transparent 1px);background-size:26px 26px;opacity:.055;"></div>
  <div class="se" style="bottom:0;left:0;right:0;height:30%;background:linear-gradient(180deg,transparent,rgba(8,4,14,.95));"></div>
  <svg class="se" style="bottom:0;left:0;width:100%;height:100%;" viewBox="0 0 800 220" preserveAspectRatio="none">
    <rect x="0" y="180" width="800" height="40" fill="#060310" opacity="1"/>
    <rect x="120" y="80" width="12" height="100" fill="#100820" opacity=".9"/>
    <rect x="150" y="60" width="14" height="120" fill="#100820" opacity=".9"/>
    <rect x="115" y="78" width="54" height="8" fill="#100820" opacity=".9"/>
    <rect x="620" y="75" width="12" height="105" fill="#180a26" opacity=".9"/>
    <rect x="650" y="55" width="14" height="125" fill="#180a26" opacity=".9"/>
    <rect x="615" y="73" width="54" height="8" fill="#180a26" opacity=".9"/>
  </svg>
  <div class="se" style="bottom:18%;left:22%;width:3px;height:65%;background:linear-gradient(180deg,rgba(201,168,76,.9),rgba(201,168,76,.0));filter:blur(1px);animation:pulse 2.2s ease-in-out infinite;"></div>
  <div class="se" style="bottom:18%;left:22%;width:60px;height:60px;transform:translateX(-28px);background:radial-gradient(circle,rgba(240,192,64,.35),transparent 70%);filter:blur(8px);animation:pulse 2.2s ease-in-out infinite;"></div>
  <div class="se" style="bottom:18%;right:22%;width:3px;height:65%;background:linear-gradient(180deg,rgba(160,50,220,.9),rgba(160,50,220,.0));filter:blur(1px);animation:pulse 1.9s ease-in-out infinite reverse;"></div>
  <div class="se" style="bottom:18%;right:22%;width:60px;height:60px;transform:translateX(-28px);background:radial-gradient(circle,rgba(160,50,220,.35),transparent 70%);filter:blur(8px);animation:pulse 1.9s ease-in-out infinite reverse;"></div>
  <div class="se" style="bottom:16%;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent 10%,rgba(201,168,76,.15) 30%,rgba(160,50,220,.15) 70%,transparent 90%);"></div>`,
  name:'The Rival\'s Demand',
  desc:'Ares materializes before you wreathed in the perfume of fresh blood. He wants you to curse the city of Mythos — a place of scholars and healers. His reasons are ancient, petty, and none of your concern. Except that fifty thousand people live there.',
  choices:[
   {g:'Ι',  t:'Challenge Ares to single combat for the fate of the city',   type:'bad',   tag:'Escalation ⚠',         delta:{faith:4, wrath:16,favor:-4},out:'Ares grins with delight — he was hoping for this. The combat shakes a mountain range. You hold your own, but the spectacle of two gods brawling delights Eris and disturbs Zeus. Wrath stirs in the divine order.'},
   {g:'ΙΙ', t:'Offer Ares a sacred bronze shield as a gift of peace',        type:'best',  tag:'Costly Diplomacy ⭐',   delta:{faith:14,wrath:0, favor:10},out:'Ares is surprised. He expected resistance. The gesture disarms him — gods understand the weight of gifts. He retreats, muttering. The city is spared. Athena sends you a dove. Your Favor among the gods surges.'},
   {g:'ΙΙΙ',t:'Refuse outright — declare the city under your divine protection', type:'good',  tag:'Clear Refusal ✓',       delta:{faith:10,wrath:3, favor:5}, out:'Ares scowls and does not press further — for now. Your resolve is noted by the gods. A small friction of Wrath enters the divine order, but the city stands and your name grows stronger.'},
   {g:'ΙV', t:'Report Ares\' demand to Zeus without comment',                type:'neutral',tag:'Celestial Deference ◆', delta:{faith:5, wrath:0, favor:3}, out:'Zeus listens, nods, and does nothing visible. Ares does not attack the city. But something shifts — you sense you are now caught between powers larger than this dispute. Favor grows slightly.'},
   {g:'V',  t:'Secretly warn the city\'s generals through mortal messengers', type:'bad',   tag:'Hidden Meddling ⚠',     delta:{faith:6, wrath:10,favor:0}, out:'The generals prepare. The city is ready. But when Ares eventually discovers the source of the warning, he is furious at the deception. Wrath enters the relationship between you and the god of war.'},
  ]
 },
 {
  act:'Act II — Rivalry Emerges',actN:2,
  scHTML:`
  <div class="se" style="inset:0;background:linear-gradient(180deg,#010208 0%,#03060f 40%,#050810 75%,#020408 100%);"></div>
  <div class="se" style="inset:0;background-image:radial-gradient(circle,rgba(255,255,255,.65) 1px,transparent 1px);background-size:20px 22px;opacity:.05;"></div>
  <svg class="se" style="bottom:0;left:0;width:100%;height:90%;" viewBox="0 0 800 220" preserveAspectRatio="none">
    <rect x="0" y="185" width="800" height="35" fill="#03060e"/>
    <rect x="30" y="120" width="70" height="65" fill="#04080e" opacity=".95"/>
    <rect x="40" y="100" width="50" height="25" fill="#04080e" opacity=".95"/>
    <polygon points="40,100 65,80 90,100" fill="#04080e" opacity=".95"/>
    <rect x="200" y="110" width="80" height="75" fill="#04080e" opacity=".92"/>
    <rect x="210" y="88" width="60" height="26" fill="#04080e" opacity=".92"/>
    <polygon points="210,88 240,65 270,88" fill="#04080e" opacity=".92"/>
    <rect x="420" y="100" width="100" height="85" fill="#04080e" opacity=".95"/>
    <rect x="432" y="76" width="76" height="30" fill="#04080e" opacity=".95"/>
    <polygon points="432,76 470,50 508,76" fill="#04080e" opacity=".95"/>
    <rect x="640" y="115" width="75" height="70" fill="#04080e" opacity=".9"/>
    <rect x="648" y="96" width="59" height="24" fill="#04080e" opacity=".9"/>
    <polygon points="648,96 677,74 706,96" fill="#04080e" opacity=".9"/>
  </svg>
  <div class="se" style="bottom:35px;left:55px;width:6px;height:55px;background:linear-gradient(180deg,rgba(255,180,40,.9),rgba(255,100,20,.5),transparent);border-radius:50% 50% 0 0;filter:blur(1px);animation:fire .5s ease-in-out infinite;"></div>
  <div class="se" style="bottom:35px;left:50px;width:16px;height:16px;background:radial-gradient(circle,rgba(255,160,40,.5),transparent 70%);filter:blur(4px);animation:pulse 1s ease-in-out infinite;"></div>
  <div class="se" style="bottom:35px;left:230px;width:6px;height:50px;background:linear-gradient(180deg,rgba(255,180,40,.9),rgba(255,100,20,.5),transparent);border-radius:50% 50% 0 0;filter:blur(1px);animation:fire .7s ease-in-out infinite reverse;"></div>
  <div class="se" style="bottom:35px;left:225px;width:16px;height:16px;background:radial-gradient(circle,rgba(255,160,40,.5),transparent 70%);filter:blur(4px);animation:pulse 1.2s ease-in-out infinite;"></div>
  <div class="se" style="bottom:35px;left:470px;width:8px;height:60px;background:linear-gradient(180deg,rgba(255,180,40,.9),rgba(255,100,20,.5),transparent);border-radius:50% 50% 0 0;filter:blur(1px);animation:fire .45s ease-in-out infinite;"></div>
  <div class="se" style="bottom:35px;left:464px;width:18px;height:18px;background:radial-gradient(circle,rgba(255,160,40,.5),transparent 70%);filter:blur(5px);animation:pulse .9s ease-in-out infinite reverse;"></div>
  <div class="se" style="bottom:0;left:0;right:0;height:35px;background:linear-gradient(180deg,transparent,rgba(255,80,20,.04));"></div>`,
  name:'Festival Under Siege',
  desc:'The Harvest Festival of Elara is tonight — lanterns, drums, sacred offerings. Hired swords approach from the east. The village guards, outnumbered and terrified, look to the sky. You feel their fear like a splinter beneath your divine skin.',
  choices:[
   {g:'Ι',  t:'Appear above the festival at full divine height — blinding, enormous', type:'bad',   tag:'Divine Theater ⚠',    delta:{faith:7, wrath:14,favor:0}, out:'The bandits flee in terror. So do half the villagers. Three people faint; an elderly woman\'s heart gives out from the shock. The festival is safe but shattered. The gods murmur that you lack proportion.'},
   {g:'ΙΙ', t:'Send a black eagle — a visible omen — to circle the bandits',        type:'good',  tag:'Divine Sign ✓',        delta:{faith:10,wrath:0, favor:2}, out:'The bandits see the eagle and hesitate. Their leader, a superstitious man, calls a retreat. The festival continues. The villagers believe Olympus watches over them, and they are right.'},
   {g:'ΙΙΙ',t:'Inspire the festival musicians to play a haunting, dissonant war hymn', type:'neutral',tag:'Subtle Influence ◆',  delta:{faith:4, wrath:0, favor:0}, out:'The music stops the bandits cold — an inexplicable dread fills their bones. They withdraw, shaken. The villagers never know the source. Faith does not surge, but nor does Wrath.'},
   {g:'ΙV', t:'Guide the villagers through a hidden valley path to safety',           type:'best',  tag:'Shepherd\'s Hand ⭐',  delta:{faith:15,wrath:0, favor:4}, out:'By dawn all five hundred villagers are safe in the hills. The bandits find an empty village and leave. In the morning, the elders give thanks with such sincerity that your Faith swells like a tide.'},
   {g:'V',  t:'Render the bandit leader blind for three days as a warning',           type:'bad',   tag:'Partial Retribution ⚠', delta:{faith:6, wrath:11,favor:0}, out:'The leader\'s blindness terrifies his men, and they flee. But word spreads that you punish mortals with affliction. Even mortals who love you grow slightly afraid. Wrath takes root.'},
  ]
 },
 {
  act:'Act III — Olympus Ascendant',actN:3,
  scHTML:`
  <div class="se" style="inset:0;background:linear-gradient(180deg,#1a0404 0%,#280808 30%,#1a0606 65%,#0a0404 100%);"></div>
  <div class="se" style="top:0;left:0;right:0;height:50%;background:radial-gradient(ellipse at 50% 0%,rgba(200,80,20,.12),transparent 70%);"></div>
  <svg class="se" style="bottom:0;left:0;width:100%;height:88%;" viewBox="0 0 800 220" preserveAspectRatio="none">
    <rect x="0" y="190" width="800" height="30" fill="#0a0303"/>
    <rect x="20" y="120" width="55" height="70" fill="#0c0404" opacity=".95"/>
    <rect x="18" y="105" width="59" height="18" fill="#0c0404" opacity=".95"/>
    <rect x="100" y="100" width="40" height="90" fill="#0c0404" opacity=".92"/>
    <rect x="98" y="86" width="44" height="17" fill="#0c0404" opacity=".92"/>
    <rect x="180" y="80" width="70" height="110" fill="#0c0404" opacity=".94"/>
    <rect x="178" y="64" width="74" height="20" fill="#0c0404" opacity=".94"/>
    <polygon points="178,64 215,42 252,64" fill="#0c0404" opacity=".94"/>
    <rect x="360" y="70" width="90" height="120" fill="#0c0404" opacity=".95"/>
    <rect x="358" y="52" width="94" height="22" fill="#0c0404" opacity=".95"/>
    <polygon points="358,52 405,28 452,52" fill="#0c0404" opacity=".95"/>
    <rect x="540" y="90" width="65" height="100" fill="#0c0404" opacity=".92"/>
    <rect x="538" y="74" width="69" height="19" fill="#0c0404" opacity=".92"/>
    <rect x="650" y="105" width="50" height="85" fill="#0c0404" opacity=".9"/>
    <rect x="720" y="120" width="40" height="70" fill="#0c0404" opacity=".88"/>
  </svg>
  <div class="se" style="bottom:30px;left:25%;width:18px;height:85px;background:linear-gradient(180deg,rgba(255,140,30,.95),rgba(220,60,10,.6),transparent);border-radius:50% 50% 0 0;filter:blur(1.5px);animation:fire .4s ease-in-out infinite;"></div>
  <div class="se" style="bottom:30px;left:24%;width:40px;height:40px;background:radial-gradient(circle,rgba(255,100,20,.4),transparent 70%);filter:blur(8px);animation:pulse 1.1s ease-in-out infinite;"></div>
  <div class="se" style="bottom:30px;left:50%;width:22px;height:100px;background:linear-gradient(180deg,rgba(255,150,30,.95),rgba(220,60,10,.6),transparent);border-radius:50% 50% 0 0;filter:blur(2px);animation:fire .35s ease-in-out infinite reverse;"></div>
  <div class="se" style="bottom:30px;left:49%;width:50px;height:50px;background:radial-gradient(circle,rgba(255,110,20,.45),transparent 70%);filter:blur(10px);animation:pulse .9s ease-in-out infinite reverse;"></div>
  <div class="se" style="bottom:30px;right:18%;width:15px;height:70px;background:linear-gradient(180deg,rgba(255,140,30,.95),rgba(220,60,10,.6),transparent);border-radius:50% 50% 0 0;filter:blur(1px);animation:fire .48s ease-in-out infinite;"></div>
  <div class="se" style="top:10%;left:50%;transform:translateX(-50%);width:120px;height:3px;background:linear-gradient(90deg,transparent,rgba(200,100,40,.6),transparent);filter:blur(2px);animation:pulse 1.5s ease-in-out infinite;"></div>
  <div class="se" style="top:5%;left:50%;transform:translateX(-50%);width:60px;height:60px;background:radial-gradient(circle,rgba(201,168,76,.2),transparent 70%);filter:blur(10px);animation:pulse 2s ease-in-out infinite;"></div>`,
  name:'The Divine Assault',
  desc:'Ares and Eris together descend on Thessalonike — fifty thousand souls. The city walls crack. You feel the deaths beginning, one by one, like candles extinguished. Every second of hesitation is a life. Every overcorrection is an age of war.',
  choices:[
   {g:'Ι',  t:'Descend and fight Ares and Eris simultaneously in the sky above the city', type:'bad',   tag:'Unrestrained Force ⚠', delta:{faith:8, wrath:17,favor:-5},out:'The divine battle devastates a quarter of the city it was meant to protect. You win. But the mortal cost is catastrophic, and your standing among the gods darkens permanently.'},
   {g:'ΙΙ', t:'Appear to the city\'s general in a vision — share the perfect battle strategy', type:'best', tag:'Invisible Hand ⭐',    delta:{faith:16,wrath:0, favor:8}, out:'The general wakes before dawn with a clarity he cannot explain. He rallies his soldiers. By midday, Ares and Eris retreat before mortal ingenuity — guided, unseen, by your wisdom. The city erupts in celebration.'},
   {g:'ΙΙΙ',t:'Call Athena and Hermes to Olympus to convene emergency intervention',   type:'good',  tag:'Unified Front ✓',      delta:{faith:11,wrath:0, favor:7}, out:'The three of you descend together. Ares, faced with a unified front, reconsiders. The attack ends diplomatically. The city is saved. Your Favor among the gods rises, though you share the glory.'},
   {g:'ΙV', t:'Curse Ares\' soldiers with sudden bone-deep exhaustion',                type:'neutral',tag:'Subtle Sabotage ◆',    delta:{faith:7, wrath:5, favor:0}, out:'The army falters, inexplicably. The defenders hold the walls. The city survives. Ares cannot prove your involvement, but he suspects. A quiet tension forms between you — not yet Wrath, but close.'},
   {g:'V',  t:'Collapse the city gates to deny entry — the walls become the trap',     type:'fail',  tag:'Fatal Miscalculation ✕',delta:{faith:-9,wrath:14,favor:-4},out:'The gates fall on fleeing civilians. The walls you collapsed trap defenders inside a burning sector. The gesture meant to save the city becomes a catastrophe. Faith crumbles. Wrath rises like a storm.'},
  ]
 },
 {
  act:'Act III — Olympus Ascendant',actN:3,
  scHTML:`
  <div class="se" style="inset:0;background:linear-gradient(180deg,#050212 0%,#08041a 40%,#05020e 80%,#020108 100%);"></div>
  <div class="se" style="inset:0;background-image:radial-gradient(circle,rgba(255,255,255,.6) 1px,transparent 1px);background-size:18px 18px;opacity:.07;"></div>
  <div class="se" style="bottom:0;left:0;right:0;height:35%;background:linear-gradient(180deg,transparent,rgba(4,2,12,.98));"></div>
  <svg class="se" style="bottom:0;left:0;width:100%;height:100%;" viewBox="0 0 800 220" preserveAspectRatio="none">
    <rect x="0" y="195" width="800" height="25" fill="#03010a"/>
    <rect x="50" y="60" width="16" height="135" fill="#080418" opacity=".95"/>
    <rect x="90" y="40" width="16" height="155" fill="#080418" opacity=".95"/>
    <rect x="130" y="55" width="16" height="140" fill="#080418" opacity=".95"/>
    <rect x="170" y="45" width="16" height="150" fill="#080418" opacity=".95"/>
    <rect x="42" y="58" width="156" height="10" fill="#080418" opacity=".95"/>
    <rect x="350" y="30" width="18" height="165" fill="#0c0522" opacity=".95"/>
    <rect x="395" y="10" width="18" height="185" fill="#0c0522" opacity=".95"/>
    <rect x="440" y="28" width="18" height="167" fill="#0c0522" opacity=".95"/>
    <rect x="342" y="28" width="124" height="12" fill="#0c0522" opacity=".95"/>
    <rect x="600" y="50" width="14" height="145" fill="#080418" opacity=".92"/>
    <rect x="638" y="35" width="14" height="160" fill="#080418" opacity=".92"/>
    <rect x="676" y="52" width="14" height="143" fill="#080418" opacity=".92"/>
    <rect x="714" y="42" width="14" height="153" fill="#080418" opacity=".92"/>
    <rect x="592" y="48" width="144" height="10" fill="#080418" opacity=".92"/>
  </svg>
  <div class="se" style="top:0;left:0;right:0;height:35%;background:radial-gradient(ellipse at 50% 0%,rgba(201,168,76,.12),transparent 65%);animation:pulse 3s ease-in-out infinite;"></div>
  <div class="se" style="top:15%;left:30%;width:2px;height:25%;background:linear-gradient(180deg,rgba(201,168,76,.6),transparent);filter:blur(.5px);animation:shim 2s ease-in-out infinite;"></div>
  <div class="se" style="top:10%;left:50%;transform:translateX(-50%);width:2px;height:35%;background:linear-gradient(180deg,rgba(201,168,76,.8),transparent);filter:blur(.5px);animation:shim 1.5s ease-in-out infinite reverse;"></div>
  <div class="se" style="top:18%;left:68%;width:2px;height:22%;background:linear-gradient(180deg,rgba(201,168,76,.5),transparent);filter:blur(.5px);animation:shim 2.5s ease-in-out infinite;"></div>
  <div class="se" style="top:8%;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent 5%,rgba(201,168,76,.2) 30%,rgba(180,76,232,.1) 70%,transparent 95%);"></div>`,
  name:'Olympus Fractures',
  desc:'The divine assembly has not convened in thirty years. Now it cannot stop convening — and nothing is resolved. Gods shout over one another. Mortals below feel the trembling sky and begin tearing down temples. They have stopped believing. All eyes land on you, the newest god, the one who has not yet chosen a faction.',
  choices:[
   {g:'Ι',  t:'Declare yourself the mediator — place your throne at the center of the assembly', type:'bad',   tag:'Veiled Ambition ⚠',    delta:{faith:4, wrath:18,favor:-6},out:'The older gods see through it immediately. A new god claiming centrality is not mediation — it is a power grab. The assembly fractures further. Wrath floods the divine order like seawater through a cracked hull.'},
   {g:'ΙΙ', t:'Propose a Covenant: gods exist to serve mortals, not to rule them',              type:'best',  tag:'The Covenant ⭐',        delta:{faith:16,wrath:-5,favor:12},out:'Silence descends. Then Athena speaks in favour. Then Hermes. One by one the assembly relents. The Covenant of the Awakened is inscribed on a golden tablet. Below, the temples are rebuilt overnight.'},
   {g:'ΙΙΙ',t:'Organize a feast of reconciliation among the warring divine factions',           type:'good',  tag:'The Feast ✓',           delta:{faith:12,wrath:-4,favor:8}, out:'Food and wine soften even divine grievances. By the feast\'s end, three old feuds are ended. Olympus does not transform — but the temperature drops, and with it, the rumbling in the mortal sky.'},
   {g:'ΙV', t:'Send mortal philosophers as emissaries to speak at the divine assembly',         type:'neutral',tag:'Mortal Voices ◆',       delta:{faith:8, wrath:0, favor:5}, out:'The gods are bewildered — then moved. A mortal, trembling before the assembly, speaks of what it feels like to live beneath quarreling gods. The words land. Some gods are changed. Others are not.'},
   {g:'V',  t:'Retreat to your own realm — Olympus sorted itself before, it will again',        type:'fail',  tag:'Abandonment ✕',        delta:{faith:-12,wrath:12,favor:-8},out:'In your absence, two younger gods clash openly. A mortal coast is swallowed by divine fire. When you return, you are not welcomed. The gods have managed without you — and remembered why.'},
  ]
 },
 {
  act:'Act III — Olympus Ascendant',actN:3,
  scHTML:`
  <div class="se" style="inset:0;background:radial-gradient(ellipse at 50% 80%,#0d0820 0%,#060410 50%,#020108 100%);"></div>
  <div class="se" style="inset:0;background-image:radial-gradient(circle,rgba(255,255,255,.55) 1px,transparent 1px);background-size:15px 15px;opacity:.06;"></div>
  <svg class="se" style="bottom:0;left:0;width:100%;height:100%;" viewBox="0 0 800 220" preserveAspectRatio="none">
    <rect x="0" y="200" width="800" height="20" fill="#040210"/>
    <rect x="60" y="50" width="14" height="150" fill="#0a061a" opacity=".95"/>
    <rect x="110" y="30" width="14" height="170" fill="#0a061a" opacity=".95"/>
    <rect x="160" y="45" width="14" height="155" fill="#0a061a" opacity=".95"/>
    <rect x="52" y="48" width="130" height="11" fill="#0a061a" opacity=".95"/>
    <rect x="52" y="196" width="130" height="8" fill="#0a061a" opacity=".95"/>
    <rect x="340" y="20" width="18" height="180" fill="#0e0828" opacity=".98"/>
    <rect x="395" y="5" width="18" height="195" fill="#0e0828" opacity=".98"/>
    <rect x="450" y="18" width="18" height="182" fill="#0e0828" opacity=".98"/>
    <rect x="330" y="18" width="148" height="14" fill="#0e0828" opacity=".98"/>
    <rect x="330" y="195" width="148" height="10" fill="#0e0828" opacity=".98"/>
    <rect x="600" y="42" width="14" height="158" fill="#0a061a" opacity=".92"/>
    <rect x="648" y="28" width="14" height="172" fill="#0a061a" opacity=".92"/>
    <rect x="696" y="40" width="14" height="160" fill="#0a061a" opacity=".92"/>
    <rect x="744" y="36" width="14" height="164" fill="#0a061a" opacity=".92"/>
    <rect x="592" y="40" width="174" height="11" fill="#0a061a" opacity=".92"/>
    <rect x="592" y="195" width="174" height="8" fill="#0a061a" opacity=".92"/>
  </svg>
  <div class="se" style="top:0;bottom:0;left:50%;transform:translateX(-50%);width:80px;background:radial-gradient(ellipse at 50% 40%,rgba(201,168,76,.14),transparent 65%);animation:pulse 3s ease-in-out infinite;"></div>
  <div class="se" style="top:8%;left:50%;transform:translateX(-50%);width:2px;height:70%;background:linear-gradient(180deg,rgba(201,168,76,.7),rgba(180,76,232,.3),transparent);filter:blur(.5px);animation:shim 2.5s ease-in-out infinite;"></div>
  <div class="se" style="top:0;left:0;right:0;height:20%;background:linear-gradient(180deg,rgba(50,20,80,.25),transparent);"></div>
  <div class="se" style="bottom:0;left:0;right:0;height:20%;background:linear-gradient(180deg,transparent,rgba(4,2,12,.9));"></div>`,
  name:'The Final Judgment',
  desc:'Eris, goddess of discord, has hidden a cursed artifact inside the Temple of the Fates — if it is not found and destroyed within one night, a divine war will begin that no mortal civilization can survive. Three gods claim to know where it is, and all three disagree.',
  choices:[
   {g:'Ι',  t:'Trust Athena\'s counsel and follow her lead to the artifact',             type:'good',  tag:'Earned Trust ✓',          delta:{faith:12,wrath:0, favor:8}, out:'Athena is right. She usually is. The artifact is destroyed. The night ends quietly. You gain a powerful ally and the satisfaction of knowing when to follow, not merely lead.'},
   {g:'ΙΙ', t:'Search the entire temple alone — divine senses, no assistance',           type:'bad',   tag:'Lone Pride ⚠',            delta:{faith:6, wrath:13,favor:0}, out:'You search for hours. Your divine pride in self-reliance means you cover the same passages three times. You find it — barely in time. The stress of the feat leaves a residue of Wrath.'},
   {g:'ΙΙΙ',t:'Consult the Fates themselves, however terrible the cost',                type:'best',  tag:'Ultimate Sacrifice ⭐',    delta:{faith:18,wrath:0, favor:10},out:'The Fates demand one year of your mortal worshippers\' prayers as payment. You accept. The artifact is found in seconds. The divine war is averted. Your Faith dips briefly, then floods back, doubled, from grateful mortals.'},
   {g:'ΙV', t:'Destroy the entire temple — artifact and all — to be safe',              type:'fail',  tag:'Scorched Resolution ✕',   delta:{faith:-10,wrath:16,favor:-8},out:'The Fates\' temple collapses. So does a portion of divine order with it. The artifact is destroyed — along with three sacred threads of mortal destiny. The Fates will not forgive this. Wrath thunders.'},
   {g:'V',  t:'Let Ares and Hermes argue while you quietly study the third god\'s clue', type:'neutral',tag:'Patient Observation ◆',   delta:{faith:7, wrath:0, favor:3}, out:'While the gods bicker, you find the artifact. You say nothing dramatic. You simply destroy it. The night ends. Some gods don\'t even realize what you did. Favor grows gently among those who noticed.'},
  ]
 },
];

const EVENTS = [
  {ic:'✦',ti:'A Temple is Raised',de:'A distant coastal city constructs a temple in your name — carved from white marble, facing the morning sea.',ef:{faith:8,wrath:0,favor:0},lb:'Faith +8'},
  {ic:'◈',ti:'Omen of Zeus',de:'A golden eagle has been spotted circling your sacred mountain. The Thunder-Father watches, and for now he is pleased.',ef:{faith:5,wrath:-5,favor:5},lb:'Faith +5, Wrath -5, Favor +5'},
  {ic:'◉',ti:'Eris Whispers',de:'The goddess of discord has been planting doubts about you in mortal minds. Some question your worthiness.',ef:{faith:-6,wrath:0,favor:0},lb:'Faith -6'},
  {ic:'◇',ti:'The Wandering Seer',de:'A blind seer arrives at your altar bearing ancient scrolls and a prophecy that your reign will outlast Olympus itself.',ef:{faith:5,wrath:0,favor:4},lb:'Faith +5, Favor +4'},
  {ic:'▲',ti:'Divine Interference',de:'An unknown spirit has been performing miracles in your name — ones you did not sanction. The mortals are confused.',ef:{faith:-4,wrath:7,favor:0},lb:'Faith -4, Wrath +7'},
  {ic:'◬',ti:'The Earth Relents',de:'After your recent deeds, the soil breathes easier. Crops bloom unsown along the roads to your shrines.',ef:{faith:7,wrath:-4,favor:0},lb:'Faith +7, Wrath -4'},
  {ic:'◫',ti:'A Hero Falls',de:'A great champion who dedicated his life to your glory has died in battle. His final prayer bore your name.',ef:{faith:6,wrath:0,favor:3},lb:'Faith +6, Favor +3'},
];

// ══════════════════════════════════════════════
// GAME STATE
// ══════════════════════════════════════════════
let GS={};
function initGS(){
  GS={faith:50,wrath:0,favor:20,si:0,done:false,
      domain:null,name:'The Ascended',
      pu:{1:false,2:false,3:false},
      shieldActive:false,wrathMult:1,
      oracleActive:false,
      hist:[],score:0};
}
initGS();

// ══════════════════════════════════════════════
// NAVIGATION
// ══════════════════════════════════════════════
function goto(id){
  document.querySelectorAll('.screen').forEach(s=>{s.classList.remove('active');s.style.display='none';});
  const el=document.getElementById(id);
  el.style.display='block';setTimeout(()=>el.classList.add('active'),10);
}
function gotoLB(){goto('slb');loadLB();}
function restart(){document.getElementById('fo').style.display='none';initGS();buildGods();goto('sgs');}

// ══════════════════════════════════════════════
// GOD SELECT
// ══════════════════════════════════════════════
function buildGods(){
  const g=document.getElementById('gg');g.innerHTML='';
  DOMAINS.forEach(d=>{
    const c=document.createElement('div');c.className='gc';
    c.innerHTML=`<span class="gi">${d.icon}</span><div class="gn">${d.name}</div><div class="gd">${d.domain}</div><div class="gb">✦ ${d.bonus}</div><div class="gp"><strong style="color:var(--gold);font-family:'Cinzel',serif;font-size:.68rem;">${d.power}:</strong><br>${d.pdesc}</div>`;
    c.onclick=()=>{GS.domain=d.id;document.querySelectorAll('.gc').forEach(x=>x.classList.remove('sel'));c.classList.add('sel');sfxSel();chkBB();};
    g.appendChild(c);
  });
  document.getElementById('pni').addEventListener('input',chkBB);
}
function chkBB(){document.getElementById('bb').disabled=!(GS.domain&&document.getElementById('pni').value.trim().length>0);}
buildGods();

function startGame(){
  const n=document.getElementById('pni').value.trim();
  if(!n||!GS.domain)return;
  GS.name=n;
  const d=DOMAINS.find(x=>x.id===GS.domain);
  GS.faith=Math.min(100,50+d.start.faith);
  GS.wrath=Math.max(0,d.start.wrath);
  GS.favor=Math.min(100,20+d.start.favor);
  if(d.id==='earth')GS.wrathMult=0.7;
  document.getElementById('plbl').textContent=`${n} · ${d.name}`;
  document.getElementById('pbn').textContent=d.power;
  updateM();
  goto('sg');
  loadScen(0);
}

// ══════════════════════════════════════════════
// METRICS
// ══════════════════════════════════════════════
function cl(v,mn,mx){return Math.max(mn,Math.min(mx,v));}
function updateM(){
  GS.faith=cl(GS.faith,0,100);GS.wrath=cl(GS.wrath,0,100);GS.favor=cl(GS.favor,0,100);
  document.getElementById('vf').textContent=GS.faith;
  document.getElementById('vw').textContent=GS.wrath;
  document.getElementById('vv').textContent=GS.favor;
  document.getElementById('bf').style.width=GS.faith+'%';
  document.getElementById('bw').style.width=GS.wrath+'%';
  document.getElementById('bv').style.width=GS.favor+'%';
  // Wrath danger pulse
  const mw=document.getElementById('met-w');
  if(GS.wrath>=40)mw.classList.add('danger');else mw.classList.remove('danger');
}
function checkFail(){
  if(GS.wrath>=70)return'The divine Wrath in your spirit has overwhelmed your grace. You have become what you feared — a wrathful god no mortal would pray to.';
  if(GS.faith<=4&&GS.wrath>=25)return'Faith has collapsed entirely and Wrath has taken its throne. The mortals light no more candles for your name.';
  if(GS.faith<=0)return'Not one mortal voice rises in prayer. Your name fades from living memory. Without faith, gods are merely shadows.';
  return null;
}

// ══════════════════════════════════════════════
// DIVINE POWER
// ══════════════════════════════════════════════
function usePower(){
  const s=SCENS[GS.si];const a=s.actN;
  if(GS.pu[a]||GS.done)return;
  GS.pu[a]=true;
  const d=DOMAINS.find(x=>x.id===GS.domain);
  sfxPower();
  document.getElementById('pbt').classList.add('used');
  let msg='';
  switch(GS.domain){
    case'wisdom': GS.oracleActive=true; msg=`Oracle's Eye activated. The choice that carries least Wrath will glow before you make it. Choose carefully.`; break;
    case'valor':  GS.shieldActive=true; msg=`Battle Grace active. The next scenario will grant double Faith from your choice.`; break;
    case'earth':  GS.wrath=Math.max(0,GS.wrath-25);updateM(); msg=`Still Waters flows through you. 25 Wrath purged from your spirit.`; break;
    case'sea':    const sw=GS.wrath;GS.wrath=Math.min(100,GS.favor);GS.favor=Math.min(100,sw);updateM(); msg=`Shifting Tide — your Wrath and Favor have exchanged places. The sea gives and takes equally.`; break;
  }
  showEv('✦',`${d.power} Activated`,msg,'');
}

// ══════════════════════════════════════════════
// SCENARIO LOADING
// ══════════════════════════════════════════════
function loadScen(idx){
  GS.si=idx;GS.done=false;
  const s=SCENS[idx];
  document.getElementById('abg').textContent=s.act;
  document.getElementById('sv').innerHTML=s.scHTML;
  document.getElementById('sn').textContent=s.name;
  document.getElementById('sdesc').textContent=s.desc;
  const c=document.getElementById('scard');c.style.animation='none';c.offsetHeight;c.style.animation='';
  // Power button
  const pb=document.getElementById('pbt');
  if(GS.pu[s.actN]){pb.classList.add('used');}else{pb.classList.remove('used');}
  // Build choices
  const con=document.getElementById('chcon');con.innerHTML='';
  // If oracle active, find the best/lowest wrath choice
  const lowestWrathType = GS.oracleActive ? (() => {
    let min=999,minIdx=0;
    s.choices.forEach((ch,i)=>{if(ch.delta.wrath<min){min=ch.delta.wrath;minIdx=i;}});
    return minIdx;
  })() : -1;
  s.choices.forEach((ch,i)=>{
    const btn=document.createElement('button');btn.className='ch';
    const oraGlow = (GS.oracleActive && i===lowestWrathType) ? ' style="border-color:rgba(180,76,232,.5);background:rgba(180,76,232,.05);"' : '';
    btn.innerHTML=`<div class="ch-glyph">${ch.g}</div><div class="ch-text"${oraGlow}>${ch.t}${GS.oracleActive&&i===lowestWrathType?' <span style="color:var(--wrath);font-size:.75rem;">◈ least Wrath</span>':''}</div>`;
    btn.onclick=()=>pick(i);
    con.appendChild(btn);
  });
  if(GS.oracleActive)GS.oracleActive=false;
  document.getElementById('ob').style.display='none';
  document.getElementById('nbt').style.display='none';
  window.scrollTo({top:0,behavior:'smooth'});
}

// ══════════════════════════════════════════════
// CHOICE
// ══════════════════════════════════════════════
async function pick(ci){
  if(GS.done)return;GS.done=true;sfxSel();
  const s=SCENS[GS.si];const ch=s.choices[ci];
  // Apply delta
  let fd=ch.delta.faith,wd=Math.round((ch.delta.wrath||0)*GS.wrathMult),vd=ch.delta.favor||0;
  if(GS.shieldActive&&fd>0){fd*=2;GS.shieldActive=false;}
  GS.faith+=fd;GS.wrath+=wd;GS.favor+=vd;updateM();
  GS.hist.push(`"${s.name}": chose "${ch.t.substring(0,40)}…" (${ch.type})`);
  // Sound
  ({best:sfxBest,good:sfxGood,neutral:sfxNeutral,bad:sfxBad,fail:sfxFail}[ch.type]||sfxFail)();
  // Mark chosen button
  document.querySelectorAll('.ch').forEach((b,i)=>{b.disabled=true;if(i===ci)b.classList.add(`sel-${ch.type}`);});
  // Show outcome loading
  const ob=document.getElementById('ob');ob.className=`ob ${ch.type}`;ob.style.display='block';
  document.getElementById('ott').textContent=ch.tag;
  document.getElementById('otx').innerHTML=`<div class="ldr"><div class="ldr-sp"></div>The Fates are weaving your story…</div>`;
  document.getElementById('pls').innerHTML='';
  // AI outcome
  let txt=ch.out;
  try{txt=await aiOutcome(s,ch,fd,wd,vd);}catch(e){}
  document.getElementById('otx').textContent=txt;
  document.getElementById('pls').innerHTML=buildPills(fd,wd,vd);
  // Fail check
  const fr=checkFail();
  if(fr){setTimeout(()=>{document.getElementById('fm').textContent=fr+' The age of your divinity ends here.';document.getElementById('fo').style.display='flex';sfxFail();},1400);return;}
  // Next
  const nb=document.getElementById('nbt');nb.style.display='inline-block';
  nb.textContent=GS.si>=SCENS.length-1?'Witness Your Legacy →':'Continue →';
}

// ══════════════════════════════════════════════
// ANTHROPIC AI OUTCOME
// ══════════════════════════════════════════════
async function aiOutcome(scen,choice,fd,wd,vd){
  const dom=DOMAINS.find(d=>d.id===GS.domain);
  const hist=GS.hist.slice(0,-1).join('; ')||'This is your first trial.';
  const prompt=`You narrate Pantheon Rising, a Greek myth strategy game. Write a vivid 2-3 sentence outcome.

Player: ${GS.name}, ${dom.name} (${dom.domain})
Metrics after choice: Faith ${GS.faith}, Wrath ${GS.wrath}, Favor ${GS.favor}
Scenario: "${scen.name}" — ${scen.desc}
Chose: "${choice.t}"
Outcome type: ${choice.type}
Past choices: ${hist}

Requirements: Reference the player by name (${GS.name}). Greek myth tone — dramatic, poetic, atmospheric. Weave in their past choices if natural. Do NOT mention numbers. Just pure story narration. 2-3 sentences maximum.`;
  const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1000,messages:[{role:'user',content:prompt}]})});
  const d=await r.json();return d.content[0].text;
}

// ══════════════════════════════════════════════
// PILLS
// ══════════════════════════════════════════════
function buildPills(fd,wd,vd){
  let h='';
  const fp=fd>0?`<span class="pill" style="color:var(--faith);border-color:var(--faith)">Faith +${fd}</span>`:'';
  const fn=fd<0?`<span class="pill" style="color:#e06850;border-color:#e06850">Faith ${fd}</span>`:'';
  const wp=wd>0?`<span class="pill" style="color:var(--wrath);border-color:var(--wrath)">Wrath +${wd}</span>`:'';
  const wn=wd<0?`<span class="pill" style="color:#8a44b8;border-color:#8a44b8">Wrath ${wd}</span>`:'';
  const vp=vd>0?`<span class="pill" style="color:var(--favor);border-color:var(--favor)">Favor +${vd}</span>`:'';
  const vn=vd<0?`<span class="pill" style="color:#e08840;border-color:#e08840">Favor ${vd}</span>`:'';
  return fp+fn+wp+wn+vp+vn;
}

// ══════════════════════════════════════════════
// NEXT / EVENTS
// ══════════════════════════════════════════════
function nextScen(){
  GS.si++;
  if(GS.si>=SCENS.length){showEnding();return;}
  if(Math.random()<.38){
    const ev=EVENTS[Math.floor(Math.random()*EVENTS.length)];
    _pendEv=ev.ef;
    showEv(ev.ic,ev.ti,ev.de,ev.lb,ev.ef);
  } else {loadScen(GS.si);}
}

let _pendEv=null;
function showEv(ic,ti,de,lb,ef=null){
  _pendEv=ef;
  document.getElementById('evic').textContent=ic;
  document.getElementById('evti').textContent=ti;
  document.getElementById('evde').textContent=de;
  const e=document.getElementById('evef');
  if(lb){e.style.display='block';e.textContent=lb;e.style.color=lb.includes('-')&&!lb.includes('Wrath -')?'var(--wrath)':'var(--faith)';}
  else e.style.display='none';
  document.getElementById('evo').style.display='flex';sfxEvent();
}
function closeEv(){
  if(_pendEv){GS.faith+=_pendEv.faith||0;GS.wrath+=_pendEv.wrath||0;GS.favor+=_pendEv.favor||0;updateM();_pendEv=null;}
  document.getElementById('evo').style.display='none';
  loadScen(GS.si);
}

// ══════════════════════════════════════════════
// ENDING
// ══════════════════════════════════════════════
async function showEnding(){
  goto('se');
  // Score
  GS.score=GS.faith*2-GS.wrath*1.5+GS.favor;
  let type,ic,ttl,su;
  if(GS.faith>=65&&GS.wrath<=30){
    type='win';ic='✦';ttl=`${GS.name}'s Eternal Glory`;
    su=`Olympus shines. The covenant holds. Every temple on every coast rings with your name — not in fear, but in love.`;
  } else if(GS.faith>=45&&GS.wrath<=55){
    type='partial';ic='◈';ttl=`A Troubled Dawn`;
    su=`The mortal world survives. Olympus is fractious but standing. ${GS.name}, your story is unfinished — and that is not nothing.`;
  } else {
    type='fail';ic='◉';ttl=`The Age of Wrath`;
    su=`The Wrath that entered your crown could not be unmade. ${GS.name} — great in potential, undone by the choices that seemed justifiable at the time.`;
  }
  try{
    const dom=DOMAINS.find(d=>d.id===GS.domain);
    const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1000,messages:[{role:'user',content:
      `Write a 3-sentence poetic ending for ${GS.name}, ${dom.name}. Final state: Faith ${GS.faith}, Wrath ${GS.wrath}, Favor ${GS.favor}. Outcome: ${type}. Journey: ${GS.hist.join('; ')}. Greek myth tone, personal, dramatic. No numbers. Make it feel earned.`}]})});
    const d=await r.json();su=d.content[0].text;
  }catch(e){}
  document.getElementById('eic').textContent=ic;
  const tl=document.getElementById('etl');tl.textContent=ttl;tl.className=`etl ${type}`;
  document.getElementById('esu').textContent=su;
  const dom=DOMAINS.find(d=>d.id===GS.domain);
  document.getElementById('ests').innerHTML=`
    <div class="est" style="color:var(--faith)">⚡ Faith: ${GS.faith}</div>
    <div class="est" style="color:var(--wrath)">◉ Wrath: ${GS.wrath}</div>
    <div class="est" style="color:var(--favor)">◇ Favor: ${GS.favor}</div>
    <div class="est" style="color:var(--gold)">◈ ${type==='win'?'Victory':type==='partial'?'Partial Victory':'Defeat'}</div>
  `;
  // Save leaderboard
  try{
    await window.storage.set(`lb:${Date.now()}:${GS.name}`,JSON.stringify({
      name:GS.name,domain:dom.name,icon:dom.icon,
      faith:GS.faith,wrath:GS.wrath,favor:GS.favor,
      score:Math.round(GS.score),outcome:type,ts:Date.now()
    }),true);
  }catch(e){}
  sfxBest();
}

// ══════════════════════════════════════════════
// LEADERBOARD
// ══════════════════════════════════════════════
async function loadLB(){
  const b=document.getElementById('lbb');b.innerHTML='<div class="lb-ld">Consulting the Fates…</div>';
  try{
    const res=await window.storage.list('lb:',true);
    if(!res||!res.keys||!res.keys.length){b.innerHTML='<div class="lb-ld" style="color:var(--dim)">No legends yet. Be the first to ascend.</div>';return;}
    const ents=[];
    for(const k of res.keys){try{const r=await window.storage.get(k,true);if(r)ents.push(JSON.parse(r.value));}catch(e){}}
    ents.sort((a,x)=>x.score-a.score);
    const oc={win:'var(--faith)',partial:'#e0a040',fail:'var(--wrath)'};
    const ol={win:'Victory',partial:'Partial',fail:'Defeat'};
    b.innerHTML=ents.slice(0,15).map((e,i)=>`
      <div class="lbr">
        <span class="lbrk ${i<3?'top':''}">${i===0?'I':i===1?'II':i===2?'III':i+1}</span>
        <span><div class="lbnm">${e.icon||''} ${e.name}</div><div class="lbbg">${e.domain||''}</div></span>
        <span style="text-align:center;color:var(--faith);font-family:'Cinzel',serif;">${e.faith}</span>
        <span style="text-align:center;color:var(--wrath);font-family:'Cinzel',serif;">${e.wrath}</span>
        <span style="text-align:center;color:var(--favor);font-family:'Cinzel',serif;">${e.favor}</span>
        <span style="text-align:center;color:${oc[e.outcome]||'var(--dim)'};font-family:'Cinzel',serif;font-size:.7rem;">${ol[e.outcome]||e.outcome}</span>
      </div>`).join('');
  }catch(e){b.innerHTML='<div class="lb-ld" style="color:var(--dim)">The Hall of Legends is temporarily sealed. Try again.</div>';}
}
updateM();
</script>
</body>
</html>
